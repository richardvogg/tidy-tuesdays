theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+geom_col()
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+geom_col()
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n),col="white")
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+geom_col()
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=10),col="white",size=10)
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+geom_col()
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=8)
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+geom_col()
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
beer %>% count(brewery,sort=T) %>% View()
library(tidyverse)
library(stringdist)
tuesdata <- tidytuesdayR::tt_load(2020, week = 43)
beer <- tuesdata$beer_awards
beer %>% count(brewery,sort=T) %>% View()
remove_duplicates <- function(vec) {
words <- vec %>%
tibble(txt=vec) %>%
dplyr::count(txt,sort=T) %>%
pull(txt)
out <- sapply(seq_along(words)[-1],function(i) {
dist2 <- stringdist(words[i],words[1:i-1],method='jw',p=0.1)
#dist2 <- stringdist(words[i],words[1:i-1],method='lv')/nchar(words[i])
best_fit <- which.min(dist2)
similarity2 <- min(dist2)
return(c(similarity2,best_fit))
}) %>%
t() %>%
as.data.frame() %>%
add_row(V1=1,V2=1,.before = 1) %>%
cbind(wordcount) %>%
dplyr::rename(distance=V1,best_fit=V2) %>%
mutate(replacement=txt[best_fit])
return(out)
}
out <- beer %>%
rowwise() %>%
mutate(city_brewery=paste(city,brewery,sep=";")) %>%
.$city_brewery %>%
#create the dataframe for decision making
remove_duplicates() %>%
separate(txt,into = c("city1","brewery_orig"),sep = ";") %>%
separate(replacement,into=c("city2","brewery_repl"),sep=";") %>%
#remove breweries with similar names but in different cities
filter(city1==city2) %>%
mutate(dist=stringdist(brewery_orig,brewery_repl,method="jw"))
remove_duplicates <- function(vec) {
wordcount <- vec %>%
tibble(txt=vec) %>%
dplyr::count(txt,sort=T)
words <- wordcount$txt
out <- sapply(seq_along(words)[-1],function(i) {
dist2 <- stringdist(words[i],words[1:i-1],method='jw',p=0.1)
#dist2 <- stringdist(words[i],words[1:i-1],method='lv')/nchar(words[i])
best_fit <- which.min(dist2)
similarity2 <- min(dist2)
return(c(similarity2,best_fit))
}) %>%
t() %>%
as.data.frame() %>%
add_row(V1=1,V2=1,.before = 1) %>%
cbind(wordcount) %>%
dplyr::rename(distance=V1,best_fit=V2) %>%
mutate(replacement=txt[best_fit])
return(out)
}
out <- beer %>%
rowwise() %>%
mutate(city_brewery=paste(city,brewery,sep=";")) %>%
.$city_brewery %>%
#create the dataframe for decision making
remove_duplicates() %>%
separate(txt,into = c("city1","brewery_orig"),sep = ";") %>%
separate(replacement,into=c("city2","brewery_repl"),sep=";") %>%
#remove breweries with similar names but in different cities
filter(city1==city2) %>%
mutate(dist=stringdist(brewery_orig,brewery_repl,method="jw"))
#Make a dictionary with replacements
dict <- out %>%
mutate(brewery_repl=ifelse(dist<=0.15,brewery_repl,brewery_orig)) %>%
filter(brewery_orig!=brewery_repl)
#remove duplicates
beer$brewery2 <- plyr::mapvalues(beer$brewery,from=dict$brewery_orig,to=dict$brewery_repl)
top10 <- beer %>% count(brewery,city,sort=T) %>%
top10b <- beer %>% count(brewery2,city,sort=T)
top10 <- beer %>% count(brewery,city,sort=T)
top10b <- beer %>% count(brewery2,city,sort=T)
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=8)
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+geom_col()
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)
after <- top10b %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery2,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)+
theme(legend.position = "none")+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)+
theme(legend.position = "none")+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n)))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-8),col="white",size=6)+
theme(legend.position = "none")+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \n Using the fuzzy duplicates method shows that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("goldenrod","grey80"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("goldenrod","grey80"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey80","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey80","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey80","goldenrod"))+
theme_void()+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme_void()+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme_void()+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
beer %>%
filter(brewery2=="Deschutes Brewery") %>% View()
top10 <- beer %>% count(brewery,city,state,sort=T)
top10b <- beer %>% count(brewery2,city,state,sort=T)
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
geom_text(aes(label=state,x=5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
geom_text(aes(label=state,x=5),col="white",size=6)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
before <- top10 %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
geom_text(aes(label=state,x=5),col="white",size=4)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="Before",subtitle="")
after <- top10b %>% slice(1:15) %>%
mutate(deschutes=ifelse(brewery2=="Deschutes Brewery","Y","N")) %>%
ggplot(aes(x=n,y=reorder(brewery2,n),fill=deschutes))+
geom_col()+
geom_text(aes(label=n,x=n-5),col="white",size=6)+
geom_text(aes(label=state,x=5),col="white",size=4)+
scale_fill_manual(values=c("grey40","goldenrod"))+
theme(legend.position = "none",
axis.text.x = element_blank())+
labs(x="Number medals",y="",title="After",subtitle="No fuzzy duplicates")
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
library(patchwork)
textcol <- "midnightblue"
before+after+plot_annotation(
title="Fuzzy duplicates",
subtitle="Deschutes Brewery was registered under a slightly different name before 2000. \nRemoving fuzzy duplicates we see that it is actually among the top 10 breweries which won most medals."
)&
theme(plot.background = element_rect(fill = "ivory"),
panel.background = element_rect(fill="ivory2"),
axis.title = element_text(family = "sans" ,size=14,colour=textcol),
axis.text = element_text(family = "sans" ,size=14,colour=textcol),
plot.title = element_text(family = "sans", face = "bold", size = 20, colour = textcol),
plot.subtitle = element_text(family = "sans" ,size=16, colour = textcol))
beer %>%
filter(brewery2=="Deschutes Brewery") %>% View()
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
ggplot(aes(x=year,y=medal,label=brewery))+
geom_segment(aes(x=1989,xend=2021,y=0,yend=0))+
geom_segment(aes(xend=year,yend=0))
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
ggplot(aes(x=year,y=as.numeric(medal),label=brewery))+
geom_segment(aes(x=1989,xend=2021,y=0,yend=0))+
geom_segment(aes(xend=year,yend=0))
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
ggplot(aes(x=year,y=1,label=brewery))+
geom_segment(aes(x=1989,xend=2021,y=0,yend=0))+
geom_segment(aes(xend=year,yend=0))
library(ggrepel)
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
ggplot(aes(x=year,y=1,label=brewery))+
geom_segment(aes(x=1989,xend=2021,y=0,yend=0))+
geom_segment(aes(xend=year,yend=0))+
geom_text_repel()
beer %>%
filter(brewery2=="Deschutes Brewery") %>%
ggplot(aes(x=year,y=1,label=brewery))+
geom_segment(aes(x=1989,xend=2021,y=0,yend=0))+
geom_segment(aes(xend=year,yend=0))+
geom_text_repel(direction = "90")
